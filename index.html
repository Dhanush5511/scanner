<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ecomen Laboratory Pvt. Ltd.</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@zxing/library@latest"></script>

</head>

<body class="bg-gray-100 min-h-screen">

<!-- HEADER -->
<header class="bg-white border-b">
<div class="w-full flex items-center gap-4 p-6">
<div class="w-16 h-16 border-2 border-dashed rounded-lg flex items-center justify-center text-gray-400">Logo</div>
<div>
<h1 class="text-2xl font-bold">Ecomen Laboratory Pvt. Ltd.</h1>
<p class="text-gray-500">Sample Registration System</p>
</div>
</div>
</header>

<!-- FORM -->
<div class="w-full min-h-screen bg-white p-10">

<form onsubmit="return validateForm()" class="max-w-4xl mx-auto">

<h2 class="font-bold text-xl">TRF DETAILS</h2>
<hr class="border-green-500 mt-2 mb-6">

<!-- SAMPLE CODE -->
<label>Sample Code *</label>
<div class="flex gap-3 mt-1">

<input id="sampleCode" autofocus
class="w-full border rounded-lg p-3"
placeholder="Enter or scan sample code">

<button type="button"
onclick="openScanner()"
class="border border-green-500 text-green-600 px-6 rounded-lg">
Scan
</button>

<label class="border border-green-500 text-green-600 px-6 rounded-lg flex items-center cursor-pointer">
Upload QR
<input type="file" accept="image/*" hidden onchange="decodeFromImage(this)">
</label>

</div>

<p class="text-sm text-gray-500 mt-1">
Use USB scanner, Scan, or Upload QR image
</p>

<!-- TYPE -->
<div class="mt-6">
<label>Type of Sample *</label>
<select id="sampleType" onchange="checkOther()"
class="w-full border rounded-lg p-3 mt-1">
<option>Select sample type</option>
<option>Blood</option>
<option>Urine</option>
<option>Others</option>
</select>

<input id="otherSample"
class="hidden w-full border rounded-lg p-3 mt-2"
placeholder="Enter sample type">
</div>

<!-- PACKAGE -->
<div class="mt-6">
<label>Package *</label>

<div id="packageInput"
onclick="togglePackageDropdown()"
class="border rounded-lg p-2 flex flex-wrap gap-2 cursor-pointer">
<span class="text-gray-400">Select packages...</span>
</div>

<div id="packageDropdown"
class="hidden border rounded-lg mt-1 max-h-56 overflow-y-scroll bg-white">

<div onclick="selectPackage('Copper')" class="p-2 hover:bg-gray-100">Copper</div>
<div onclick="selectPackage('Cobalt')" class="p-2 hover:bg-gray-100">Cobalt</div>
<div onclick="selectPackage('Chromium')" class="p-2 hover:bg-gray-100">Chromium</div>
<div onclick="selectPackage('Antimony')" class="p-2 hover:bg-gray-100">Antimony</div>
<div onclick="selectPackage('Iron')" class="p-2 hover:bg-gray-100">Iron</div>
<div onclick="selectPackage('Cadmium')" class="p-2 hover:bg-gray-100">Cadmium</div>
<div onclick="selectPackage('Nickel')" class="p-2 hover:bg-gray-100">Nickel</div>
<div onclick="selectPackage('Zinc')" class="p-2 hover:bg-gray-100">Zinc</div>
<div onclick="selectPackage('Lead')" class="p-2 hover:bg-gray-100">Lead</div>
<div onclick="selectPackage('Mercury')" class="p-2 hover:bg-gray-100">Mercury</div>

</div>

<!-- CUSTOMER -->
<h2 class="font-bold text-xl mt-10">Customer Details (Optional)</h2>
<hr class="border-green-500 mt-2 mb-6">

<div class="grid grid-cols-2 gap-6">
<input placeholder="Name" class="border p-3 rounded-lg">
<input placeholder="Age" type="number" class="border p-3 rounded-lg">

<select class="border p-3 rounded-lg">
<option>Select Sex</option>
<option>Male</option>
<option>Female</option>
<option>Other</option>
</select>

<input placeholder="Location" class="border p-3 rounded-lg">
</div>

<!-- COLLECTION -->
<h2 class="font-bold text-xl mt-10">Collection Details</h2>
<hr class="border-green-500 mt-2 mb-6">

<div class="grid grid-cols-2 gap-6">
<input id="collectionDT" type="datetime-local"
class="border p-3 rounded-lg">

<input id="timestamp" readonly
class="border p-3 rounded-lg bg-gray-100">
</div>

<!-- NEXT -->
<div class="flex justify-center mt-10">
<button class="bg-green-600 text-white px-20 py-3 rounded-lg text-lg">
Next
</button>
</div>

</form>
</div>

<!-- FULLSCREEN SCANNER -->
<div id="scannerModal"
class="fixed inset-0 bg-black hidden
flex flex-col items-center justify-center z-50">

<p class="text-white mb-2">Align QR / Barcode inside camera</p>

<div id="reader"></div>

<button onclick="closeScanner()"
class="mt-4 bg-red-500 text-white px-10 py-3 rounded">
Cancel
</button>
</div>

<!-- SCRIPT -->
<script>

let selectedPackages=[];
let codeReader=new ZXing.BrowserMultiFormatReader();
let currentStream=null;

/* OPEN SCANNER */
async function openScanner(){

scannerModal.classList.remove("hidden");

try{
const stream=await navigator.mediaDevices.getUserMedia({
video:{
facingMode:"environment",
width:{ideal:1280},
height:{ideal:720}
}
});

currentStream=stream;

const video=document.createElement("video");
video.style.width="90vw";
video.style.maxWidth="500px";
video.setAttribute("playsinline",true);

reader.innerHTML="";
reader.appendChild(video);

video.srcObject=stream;
video.play();

codeReader.decodeFromVideoElement(video,(result,err)=>{
if(result){
sampleCode.value=result.text;
closeScanner();
}
});

}catch(e){
alert("Camera permission denied");
}
}

/* UPLOAD IMAGE QR */
function decodeFromImage(input){
const file=input.files[0];
if(!file) return;

const fr=new FileReader();
fr.onload=function(){
codeReader.decodeFromImage(undefined,fr.result)
.then(r=>sampleCode.value=r.text)
.catch(()=>alert("QR not detected"));
}
fr.readAsDataURL(file);
}

/* CLOSE */
function closeScanner(){
if(currentStream){
currentStream.getTracks().forEach(t=>t.stop());
}
scannerModal.classList.add("hidden");
}

/* OTHERS */
function checkOther(){
otherSample.classList.toggle("hidden",sampleType.value!=="Others");
}

/* PACKAGES */
function togglePackageDropdown(){
packageDropdown.classList.toggle("hidden");
}

function selectPackage(pkg){
if(!selectedPackages.includes(pkg)){
selectedPackages.push(pkg);
renderPackages();
}
}

function removePackage(pkg){
selectedPackages=selectedPackages.filter(p=>p!==pkg);
renderPackages();
}

function renderPackages(){
packageInput.innerHTML="";
if(selectedPackages.length===0){
packageInput.innerHTML="<span class='text-gray-400'>Select packages...</span>";
return;
}
selectedPackages.forEach(p=>{
packageInput.innerHTML+=`
<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
${p} <span onclick="removePackage('${p}')" style="cursor:pointer">âœ–</span>
</span>`;
});
}

/* TIMESTAMP */
function setTimestamp(){
let d=new Date();
timestamp.value=
d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+
d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
}
setTimestamp();

/* VALIDATE */
function validateForm(){

if(sampleCode.value.trim()==""){
alert("Enter Sample Code"); return false;
}

if(sampleType.value=="Select sample type"){
alert("Select Sample Type"); return false;
}

if(selectedPackages.length==0){
alert("Select at least one Package"); return false;
}

if(collectionDT.value==""){
alert("Select Collection Date & Time"); return false;
}

return true;
}

</script>

</body>
</html>
